<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Panel â€” IITWorks MSU-IIT</title>
  
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Common CSS -->
  <link rel="stylesheet" href="css/style.css">
  
  <style>
    .admin-container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
    }
    
    .admin-header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }
    
    .admin-header h1 {
      color: var(--primary);
      font-size: 36px;
      margin-bottom: 10px;
    }
    
    .admin-tabs {
      display: flex;
      margin-bottom: 30px;
      background: #fff5f5;
      border-radius: 16px;
      padding: 6px;
      border: 2px solid var(--border);
    }
    
    .admin-tab {
      flex: 1;
      padding: 16px;
      text-align: center;
      font-weight: 700;
      cursor: pointer;
      color: var(--muted);
      border-radius: 12px;
      transition: all 0.3s;
      font-size: 16px;
    }
    
    .admin-tab:hover {
      background: rgba(102, 0, 0, 0.05);
    }
    
    .admin-tab.active {
      background: white;
      color: var(--primary);
      box-shadow: 0 4px 12px rgba(102, 0, 0, 0.1);
    }
    
    .admin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 16px;
      border: 2px solid var(--border);
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .stat-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--primary), var(--primary-hover));
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin: 0 auto 15px;
    }
    
    .stat-number {
      font-size: 36px;
      font-weight: 800;
      color: var(--primary);
      display: block;
      margin-bottom: 5px;
    }
    
    .stat-label {
      color: var(--muted);
      font-size: 14px;
      font-weight: 600;
    }
    
    .admin-content {
      background: white;
      border-radius: 16px;
      padding: 30px;
      border: 2px solid var(--border);
      box-shadow: 0 8px 30px rgba(0,0,0,0.05);
    }
    
    .table-container {
      overflow-x: auto;
      margin-top: 20px;
    }
    
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    
    .admin-table th {
      background: #fff5f5;
      color: var(--primary);
      font-weight: 700;
      padding: 15px;
      text-align: left;
      border-bottom: 2px solid var(--border);
    }
    
    .admin-table td {
      padding: 15px;
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
    }
    
    .admin-table tr:hover {
      background: #fff5f5;
    }
    
    .admin-table .actions {
      display: flex;
      gap: 10px;
    }
    
    .action-btn {
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s;
    }
    
    .delete-btn {
      background: #fee2e2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }
    
    .delete-btn:hover {
      background: #dc2626;
      color: white;
    }
    
    .edit-btn {
      background: #dbeafe;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
    }
    
    .edit-btn:hover {
      background: #1d4ed8;
      color: white;
    }
    
    .role-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
    }
    
    .role-admin {
      background: #fef3c7;
      color: #92400e;
    }
    
    .role-user {
      background: #d1fae5;
      color: #065f46;
    }
    
    .no-data {
      text-align: center;
      padding: 40px;
      color: var(--muted);
    }
    
    .search-box {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
    }
    
    .search-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .search-input:focus {
      border-color: var(--primary);
      outline: none;
    }
    
    .category-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 20px;
    }
    
    .category-stat {
      padding: 10px 20px;
      background: #fff5f5;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .category-stat.art {
      background: var(--art-tag);
      color: var(--art-text);
    }
    
    .category-stat.tech {
      background: var(--tech-tag);
      color: var(--tech-text);
    }
    
    .category-stat.acad {
      background: var(--acad-tag);
      color: var(--acad-text);
    }
    
    .category-stat.food {
      background: var(--food-tag);
      color: var(--food-text);
    }
    
    .category-stat.other {
      background: var(--other-tag);
      color: var(--other-text);
    }
    
    .delete-confirm-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .delete-modal-content {
      background: white;
      padding: 30px;
      border-radius: 16px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .delete-modal-header {
      color: #dc2626;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .delete-modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }
    
    @media (max-width: 768px) {
      .admin-table {
        font-size: 12px;
      }
      
      .admin-table th,
      .admin-table td {
        padding: 10px;
      }
      
      .actions {
        flex-direction: column;
      }
      
      .action-btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>

  <!-- Authentication check -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const user = JSON.parse(localStorage.getItem('currentUser') || 'null');
        if (!user || user.role !== 'admin') {
            // Redirect to landing page if not admin
            showSuccessMessage('Admin access required', 'error');
            setTimeout(() => {
                window.location.href = 'landing.html';
            }, 2000);
        }
    });
  </script>

  <header>
    <div class="hdr">
      <div class="nav-left">
        <a href="index.html" class="brand">
            <svg width="32" height="32" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#660000;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#4d0000;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <rect x="0" y="0" width="100" height="100" rx="20" fill="url(#logoGrad)" />
                <path d="M25 30 L35 70 L50 40 L65 70 L75 30" stroke="#FFD700" stroke-width="8" fill="none"/>
                <circle cx="50" cy="50" r="15" fill="none" stroke="#FFD700" stroke-width="3"/>
            </svg>
            <div class="brand-text">IIT<span>Works</span> <span class="iit-badge">MSU-IIT</span></div>
        </a>
        <a href="index.html" class="nav-link">Home</a>
        <a href="directory.html" class="nav-link">Student Directory</a>
        <a href="admin.html" class="nav-link active">Admin Panel</a>
        <a href="landing2.html" style="background: var(--primary); color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 13px; display: flex; align-items: center; gap: 6px; transition: 0.2s; text-decoration: none; border: 1px solid #FFD700; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
    <i class="fas fa-scroll"></i> Gig Quest
</a>
      </div>
      <div class="nav-right" id="navAuth">
        <!-- Will be populated by JavaScript -->
      </div>
    </div>
  </header>

  <div class="admin-container">
    <div class="admin-header">
      <h1><i class="fas fa-crown"></i> Admin Panel</h1>
      <p style="color: var(--muted);">Manage users, services, and platform settings</p>
    </div>
    
    <!-- Stats Cards -->
    <div class="admin-stats" id="adminStats">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-users"></i>
        </div>
        <span class="stat-number" id="totalUsers">0</span>
        <span class="stat-label">Total Users</span>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-briefcase"></i>
        </div>
        <span class="stat-number" id="totalJobs">0</span>
        <span class="stat-label">Total Services</span>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-user-check"></i>
        </div>
        <span class="stat-number" id="activeUsers">0</span>
        <span class="stat-label">Active Users</span>
      </div>
    </div>
    
    <!-- Category Stats -->
    <div style="margin-bottom: 30px;">
      <h3 style="color: var(--primary); margin-bottom: 15px;">Services by Category</h3>
      <div class="category-stats" id="categoryStats">
        <!-- Will be populated by JavaScript -->
      </div>
    </div>
    
    <!-- Admin Tabs -->
    <div class="admin-tabs">
      <div class="admin-tab active" onclick="switchAdminTab('services')">
        <i class="fas fa-briefcase"></i> All Services
      </div>
      <div class="admin-tab" onclick="switchAdminTab('users')">
        <i class="fas fa-users"></i> All Users
      </div>
    </div>
    
    <!-- Search Box -->
    <div class="search-box">
      <input type="text" class="search-input" id="adminSearch" placeholder="Search services or users..." onkeyup="adminSearch()">
    </div>
    
    <!-- Services Tab -->
    <div id="services-tab" class="admin-content">
      <h2 style="color: var(--primary); margin-bottom: 20px;">
        <i class="fas fa-briefcase"></i> Manage Services
      </h2>
      
      <div class="table-container">
        <table class="admin-table" id="servicesTable">
          <thead>
            <tr>
              <th>Service Title</th>
              <th>Posted By</th>
              <th>Category</th>
              <th>Price</th>
              <th>Date Posted</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="servicesList">
            <!-- Will be populated by JavaScript -->
            <tr>
              <td colspan="6" class="no-data">
                <i class="fas fa-spinner fa-spin"></i> Loading services...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Users Tab -->
    <div id="users-tab" class="admin-content hidden">
      <h2 style="color: var(--primary); margin-bottom: 20px;">
        <i class="fas fa-users"></i> Manage Users
      </h2>
      
      <div class="table-container">
        <table class="admin-table" id="usersTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Course</th>
              <th>Role</th>
              <th>Services Posted</th>
              <th>Join Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="usersList">
            <!-- Will be populated by JavaScript -->
            <tr>
              <td colspan="7" class="no-data">
                <i class="fas fa-spinner fa-spin"></i> Loading users...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteConfirmModal" class="delete-confirm-modal hidden">
    <div class="delete-modal-content">
      <div class="delete-modal-header">
        <i class="fas fa-exclamation-triangle" style="font-size: 24px;"></i>
        <h3 style="margin: 0;" id="deleteModalTitle">Confirm Delete</h3>
      </div>
      <p id="deleteModalMessage">Are you sure you want to delete this item?</p>
      <div class="delete-modal-actions">
        <button onclick="closeDeleteModal()" style="padding: 10px 20px; background: #e5e7eb; border: none; border-radius: 8px; cursor: pointer;">
          Cancel
        </button>
        <button onclick="confirmDeleteAction()" style="padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 8px; cursor: pointer;">
          <i class="fas fa-trash"></i> Delete
        </button>
      </div>
    </div>
  </div>

  <!-- SUCCESS MESSAGE -->
  <div id="successMessage" class="success-message hidden">
      <i class="fas fa-check-circle" style="font-size: 20px;"></i>
      <div>
          <div style="font-weight: 700;" id="successTitle">Success!</div>
          <div style="font-size: 13px;" id="successSubtitle"></div>
      </div>
  </div>

  <!-- Common JS -->
  <script src="js/main.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/admin.js"></script>
  
  <script>
    // Global variables for delete actions
    let currentDeleteType = ''; // 'job' or 'user'
    let currentDeleteId = null;
    let currentDeleteTitle = '';
    
    document.addEventListener('DOMContentLoaded', function() {
        // Check admin access
        const user = JSON.parse(localStorage.getItem('currentUser') || 'null');
        if (!user || user.role !== 'admin') {
            return;
        }
        
        // Initialize admin panel
        loadAdminStats();
        loadAllServices();
        loadAllUsers();
        updateNavForAuth();
    });
    
    function switchAdminTab(tab) {
        document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
        document.getElementById('services-tab').classList.toggle('hidden', tab !== 'services');
        document.getElementById('users-tab').classList.toggle('hidden', tab !== 'users');
        
        const activeTab = document.querySelector(`.admin-tab[onclick*="${tab}"]`);
        if (activeTab) activeTab.classList.add('active');
    }
    
    function loadAdminStats() {
        const stats = Admin.getStats();
        
        document.getElementById('totalUsers').textContent = stats.totalUsers;
        document.getElementById('totalJobs').textContent = stats.totalJobs;
        document.getElementById('activeUsers').textContent = stats.activeUsers;
        
        // Display category stats
        const categoryStatsDiv = document.getElementById('categoryStats');
        categoryStatsDiv.innerHTML = '';
        
        for (const [category, count] of Object.entries(stats.jobsByCategory)) {
            const categoryName = getCategoryName(category);
            const categoryDiv = document.createElement('div');
            categoryDiv.className = `category-stat ${category}`;
            categoryDiv.innerHTML = `
                <span>${categoryName}</span>
                <span style="margin-left: 8px; background: white; padding: 2px 8px; border-radius: 10px;">${count}</span>
            `;
            categoryStatsDiv.appendChild(categoryDiv);
        }
    }
    
    function loadAllServices() {
        const jobs = Admin.getAllJobsWithUsers();
        const servicesList = document.getElementById('servicesList');
        
        if (jobs.length === 0) {
            servicesList.innerHTML = `
                <tr>
                    <td colspan="6" class="no-data">
                        <i class="fas fa-inbox"></i>
                        <p>No services have been posted yet</p>
                    </td>
                </tr>
            `;
            return;
        }
        
        servicesList.innerHTML = '';
        
        jobs.sort((a, b) => b.id - a.id).forEach(job => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <strong>${job.title}</strong><br>
                    <small style="color: var(--muted);">${job.description.substring(0, 60)}...</small>
                </td>
                <td>
                    <strong>${job.postedBy}</strong><br>
                    <small style="color: var(--muted);">${job.userEmail}</small>
                </td>
                <td>
                    <span class="badge-iitian">${getCategoryName(job.category)}</span>
                </td>
                <td>
                    <strong>${job.price}</strong>
                </td>
                <td>
                    ${new Date(job.id).toLocaleDateString()}<br>
                    <small style="color: var(--muted);">${job.posted}</small>
                </td>
                <td>
                    <div class="actions">
                        <button class="action-btn delete-btn" onclick="showDeleteJobModal(${job.id}, '${job.title.replace(/'/g, "\\'")}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </td>
            `;
            servicesList.appendChild(row);
        });
    }
    
    function loadAllUsers() {
        const users = Admin.getAllUsers();
        const jobs = JSON.parse(localStorage.getItem('iitWorksServices') || '[]');
        const usersList = document.getElementById('usersList');
        
        if (users.length === 0) {
            usersList.innerHTML = `
                <tr>
                    <td colspan="7" class="no-data">
                        <i class="fas fa-users"></i>
                        <p>No users found</p>
                    </td>
                </tr>
            `;
            return;
        }
        
        usersList.innerHTML = '';
        
        users.forEach(user => {
            // Count user's jobs
            const userJobs = jobs.filter(job => job.userId === user.id);
            const jobsCount = userJobs.length;
            
            // Format join date
            const joinDate = new Date(user.createdAt).toLocaleDateString();
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>
                    <strong>${user.name}</strong>
                    ${user.role === 'admin' ? '<span class="badge-iitian" style="margin-left: 5px;">ADMIN</span>' : ''}
                </td>
                <td>${user.email}</td>
                <td>${user.course}</td>
                <td>
                    <span class="role-badge role-${user.role}">${user.role.toUpperCase()}</span>
                </td>
                <td>
                    <strong>${jobsCount}</strong> service${jobsCount !== 1 ? 's' : ''}
                </td>
                <td>${joinDate}</td>
                <td>
                    <div class="actions">
                        ${user.role !== 'admin' ? `
                        <button class="action-btn edit-btn" onclick="promoteToAdmin(${user.id})">
                            <i class="fas fa-crown"></i> Make Admin
                        </button>
                        ` : ''}
                        <button class="action-btn delete-btn" 
                                onclick="showDeleteUserModal(${user.id}, '${user.name.replace(/'/g, "\\'")}', ${jobsCount})"
                                ${user.role === 'admin' ? 'disabled style="opacity: 0.5;"' : ''}>
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </td>
            `;
            usersList.appendChild(row);
        });
    }
    
    function adminSearch() {
        const searchTerm = document.getElementById('adminSearch').value.toLowerCase().trim();
        
        // Search in services table
        const serviceRows = document.querySelectorAll('#servicesList tr');
        serviceRows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
        
        // Search in users table
        const userRows = document.querySelectorAll('#usersList tr');
        userRows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    }
    
    function showDeleteJobModal(jobId, jobTitle) {
        currentDeleteType = 'job';
        currentDeleteId = jobId;
        currentDeleteTitle = jobTitle;
        
        document.getElementById('deleteModalTitle').textContent = 'Delete Service';
        document.getElementById('deleteModalMessage').innerHTML = `
            Are you sure you want to delete the service:<br>
            <strong>"${jobTitle}"</strong>?<br><br>
            <span style="color: #dc2626;">
                <i class="fas fa-exclamation-triangle"></i> 
                This action cannot be undone.
            </span>
        `;
        
        document.getElementById('deleteConfirmModal').classList.remove('hidden');
    }
    
    function showDeleteUserModal(userId, userName, jobsCount) {
        currentDeleteType = 'user';
        currentDeleteId = userId;
        currentDeleteTitle = userName;
        
        let jobsWarning = '';
        if (jobsCount > 0) {
            jobsWarning = `<br><span style="color: #dc2626;">
                <i class="fas fa-exclamation-triangle"></i> 
                This will also delete ${jobsCount} service${jobsCount !== 1 ? 's' : ''} posted by this user.
            </span>`;
        }
        
        document.getElementById('deleteModalTitle').textContent = 'Delete User';
        document.getElementById('deleteModalMessage').innerHTML = `
            Are you sure you want to delete the user:<br>
            <strong>"${userName}"</strong>?${jobsWarning}<br><br>
            <span style="color: #dc2626;">
                <i class="fas fa-exclamation-triangle"></i> 
                This action cannot be undone.
            </span>
        `;
        
        document.getElementById('deleteConfirmModal').classList.remove('hidden');
    }
    
    function closeDeleteModal() {
        document.getElementById('deleteConfirmModal').classList.add('hidden');
        currentDeleteType = '';
        currentDeleteId = null;
        currentDeleteTitle = '';
    }
    
    function confirmDeleteAction() {
        if (currentDeleteType === 'job') {
            deleteJob(currentDeleteId);
        } else if (currentDeleteType === 'user') {
            deleteUser(currentDeleteId);
        }
        closeDeleteModal();
    }
    
    function deleteJob(jobId) {
        const result = Admin.deleteJob(jobId);
        
        if (result.success) {
            showSuccessMessage(`Service deleted: "${result.jobTitle}"`);
            loadAllServices();
            loadAdminStats(); // Update stats
        } else {
            showSuccessMessage(result.message, 'error');
        }
    }
    
    function deleteUser(userId) {
        const result = Admin.deleteUser(userId);
        
        if (result.success) {
            showSuccessMessage(`User "${result.userName}" deleted. ${result.jobsDeleted} service${result.jobsDeleted !== 1 ? 's were' : ' was'} also removed.`);
            loadAllUsers();
            loadAllServices(); // Update services list
            loadAdminStats(); // Update stats
        } else {
            showSuccessMessage(result.message, 'error');
        }
    }
    
    function promoteToAdmin(userId) {
        if (confirm('Are you sure you want to make this user an admin?')) {
            const result = Admin.updateUserRole(userId, 'admin');
            
            if (result.success) {
                showSuccessMessage(`User "${result.userName}" is now an admin`);
                loadAllUsers();
            } else {
                showSuccessMessage(result.message, 'error');
            }
        }
    }
  </script>
<footer>

    <div class="footer-container">

        

        <div class="footer-col footer-brand">

            <div class="brand">

                <i class="fa-solid fa-graduation-cap" style="color: #FFD700;"></i>

                <div class="brand-text">IIT<span>Works</span></div>

            </div>

            <p>The exclusive Campus Quest for MSU-IIT.</p>

        </div>


        <div class="footer-col">

            <h3>Quick Links</h3>

            <ul class="footer-links">

                <li><a href="index.html">Home</a></li>

                <li><a href="landing2.html">Quest Board</a></li>

                <li><a href="post2.html">Post Service</a></li>

            </ul>

        </div>


        <div class="footer-col">

            <h3>Support</h3>

            <ul class="footer-links">

                <li><a href="#">About</a></li>

                <li><a href="#">Privacy</a></li>

                <li><a href="#">Terms</a></li>

            </ul>

        </div>


        <div class="footer-col">

            <h3>Connect</h3>

            <div class="social-icons">

                <a href="#" class="social-btn"><i class="fab fa-facebook-f"></i></a>

                <a href="#" class="social-btn"><i class="fab fa-twitter"></i></a>

                <a href="#" class="social-btn"><i class="fab fa-telegram-plane"></i></a>

            </div>

        </div>


    </div>


    <div class="footer-bottom">

        &copy; 2025 IIT Works | CCC100

    </div>

</footer>
</body>
</html>